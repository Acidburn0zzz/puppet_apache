<VirtualHost *:80>
    Include conf.d/defaults.inc

    ServerName <%= servername %>
    <%- unless serveralias.to_s.empty? then -%>
    ServerAlias <%= serveralias %>
    <%- end -%> 
    DocumentRoot <%= documentroot %>/

    ErrorLog <%= logdir %>/error_log
    CustomLog <%= logdir %>/access_log combined

    <Directory "<%= documentroot %>/">
        AllowOverride <%= allow_override %>
        <%- unless options.to_s == 'absent' then -%>
        Options <%= options %>
        <%- end -%>
        <%- unless htpasswd_file.to_s == 'absent' then -%>

        AuthType Basic
        AuthName "Access fuer <%= servername %>"
        AuthUserFile <%= htpasswd_path %>
        require valid-user

        <%- end -%>
        php_admin_flag engine on
        php_admin_value open_basedir <%= documentroot %>:<%= php_upload_tmp_dir %>:<%= php_session_save_path %>
        php_admin_value upload_tmp_dir <%= php_upload_tmp_dir %>
        php_admin_value session.save_path <%= php_session_save_path %>
    </Directory>

    <IfModule mod_security2.c>
        SecRuleEngine <%= if mod_security.to_s == 'true' then "On" else "Off" end -%>
    </IfModule>

    <%- unless additional_options.to_s == 'absent' then -%>
    <%= additional_options %>
    <%- end -%>
</VirtualHost>
